<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Lucky Racer</title>
    <link rel="stylesheet" href="style.css?v=45" />
  </head>
  <body>
    <!-- Login Modal -->
    <!-- <div id="loginModal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999;">
        <div style="background:#222;padding:32px 24px 24px 24px;border-radius:12px;box-shadow:0 4px 32px #0006;min-width:320px;max-width:90vw;">
            <h2 style="color:#fff;text-align:center;margin-bottom:18px;">ÄÄƒng nháº­p Ä‘á»ƒ vÃ o Lucky Racer</h2>
            <div style="display:flex;flex-direction:column;gap:12px;">
                <input id="loginUsername" type="text" placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p" style="padding:10px 12px;border-radius:6px;border:1px solid #888;font-size:16px;outline:none;">
                <div style="display:flex;align-items:center;gap:8px;">
                    <input id="loginPassword" type="password" placeholder="Nháº­p máº­t kháº©u" style="padding:10px 12px;border-radius:6px;border:1px solid #888;font-size:16px;outline:none;flex:1;">
                    <label style="color:#fff;font-size:13px;cursor:pointer;user-select:none;">
                        <input type="checkbox" id="showLoginPassword" style="margin-right:2px;"> Hiá»‡n
                    </label>
                </div>
                <label style="color:#fff;font-size:15px;display:flex;align-items:center;gap:8px;">
                    <input type="checkbox" id="isAdmin" style="width:16px;height:16px;"> ÄÄƒng nháº­p vá»›i quyá»n admin
                </label>
                <button id="loginBtn" style="padding:10px 0;border-radius:6px;background:#667eea;color:#fff;font-size:16px;border:none;cursor:pointer;position:relative;">ÄÄƒng nháº­p
                    <span id="loginLoadingSpinner" style="display:none;position:absolute;right:16px;top:50%;transform:translateY(-50%);">
                        <span class="loading-spinner" style="width:22px;height:22px;border-width:3px;margin:0;"></span>
                    </span>
                </button>
                <div id="loginError" style="color:#ff7675;text-align:center;display:none;font-size:14px;">Vui lÃ²ng nháº­p tÃªn Ä‘Äƒng nháº­p!</div>
            </div>
        </div>
    </div> -->
    <!-- Remove tab navigation, keep single page -->
    <!-- <div class="container" id="mainContent" style="display:none;"> -->
    <div class="container" id="mainContent">
      <h1>The Lucky Racer - Settings</h1>

      <!-- Loading Indicator -->
      <div class="loading-container" id="loadingContainer">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Loading icons...</div>
        <div class="loading-progress" id="loadingProgress">0%</div>
      </div>

      <!-- Game Settings -->
      <div class="settings-panel" id="settingsPanel">
        <h2>Race Settings</h2>

        <!-- Simplified Prize Setup (Top Priority) -->
        <div
          style="
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(255, 215, 0, 0.15);
            border: 2px solid #ffd700;
            border-radius: 8px;
          "
        >
          <h3 style="color: #ffd700; margin: 0 0 15px 0; font-size: 18px">
            ğŸ† Táº¡o Script Äua
          </h3>
          <div style="display: flex; gap: 10px; margin-bottom: 12px">
            <input
              type="text"
              id="simplePrizeName"
              placeholder="TÃªn giáº£i (VD: Giáº£i Nháº¥t)"
              style="
                flex: 2;
                padding: 12px;
                background: #222;
                color: white;
                border: 1px solid #444;
                border-radius: 5px;
                font-size: 14px;
              "
            />
            <input
              type="number"
              id="simplePrizeCount"
              value="1"
              min="1"
              placeholder="Sá»‘ ngÆ°á»i"
              style="
                flex: 1;
                padding: 12px;
                background: #222;
                color: white;
                border: 1px solid #444;
                border-radius: 5px;
                max-width: 100px;
                font-size: 14px;
              "
            />
            <button
              class="btn"
              onclick="if (window.game) game.addRaceScript();"
              style="
                background: #27ae60;
                padding: 12px 20px;
                margin: 0;
                font-size: 14px;
                white-space: nowrap;
              "
            >
              + Táº¡o Script
            </button>
          </div>
          <div
            id="raceScriptsList"
            style="
              background: rgba(0, 0, 0, 0.4);
              border-radius: 5px;
              padding: 12px;
              min-height: 60px;
              color: white;
              font-size: 13px;
              max-height: 300px;
              overflow-y: auto;
              border: 1px solid #444;
            "
          >
            <i style="color: #888">ChÆ°a cÃ³ script nÃ o Ä‘Æ°á»£c táº¡o...</i>
          </div>
          <small style="color: #888; display: block; margin-top: 8px">
            ğŸ’¡ Má»—i script = 1 láº§n Ä‘ua. Nháº¥n START Ä‘á»ƒ cháº¡y Ä‘ua vá»›i giáº£i Ä‘Ã³
          </small>
        </div>

        <!-- Control Panel (for control window) -->
        <div
          class="control-panel"
          id="controlPanel"
          style="
            margin-top: 20px;
            position: relative;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
          "
        >
          <!-- <button class="btn btn-small" onclick="game.goHome()" id="homeBtn">
            ğŸ  Home
          </button> -->
          <div class="input-group">
            <label for="raceDuration" style="font-size: 16px; font-weight: bold"
              >Race Duration (seconds):</label
            >
            <input
              type="number"
              id="raceDuration"
              min="5"
              max="300"
              value="30"
              style="font-size: 18px; padding: 12px; font-weight: bold"
            />
          </div>
          <button
            class="btn btn-small"
            onclick="game.controlStartRace()"
            id="controlStartBtn"
            disabled
          >
            Loading...
          </button>
          <button
            class="btn btn-small"
            onclick="game.pauseRace()"
            id="pauseBtn"
          >
            â¸ Pause
          </button>
          <button
            class="btn btn-small"
            onclick="game.resumeRace()"
            id="resumeBtn"
            disabled
          >
            â–¶ Resume
          </button>
          <button
            class="btn btn-primary"
            onclick="game.continueRace()"
            id="continueBtn"
            style="display: none"
          >
            ğŸ¯ Next Race
          </button>
          <button
            class="btn btn-primary"
            onclick="game.nextRace()"
            id="nextRaceBtn"
            style="display: none; background: #3498db"
          >
            â¡ï¸ Next Race
          </button>
          <button
            class="btn btn-secondary"
            onclick="
              game.resetHistory();
              location.reload();
            "
            id="resetHistoryBtn"
            style="background: #e74c3c"
          >
            ğŸ”„ Restart
          </button>
        </div>
        <!-- end control panel -->

        <!-- File Upload Section - Enlarged and Highlighted -->
        <div
          style="
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(
              135deg,
              rgba(102, 126, 234, 0.15),
              rgba(118, 75, 162, 0.15)
            );
            border: 2px solid #667eea;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
          "
        >
          <h3
            style="
              color: #667eea;
              margin: 0 0 15px 0;
              font-size: 18px;
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 8px;
            "
          >
            <span>ğŸ“Š Danh sÃ¡ch ngÆ°á»i chÆ¡i</span>
            <button
              class="btn btn-small"
              onclick="game.togglePlayerListSection()"
              style="
                background: #667eea;
                padding: 5px 12px;
                font-size: 14px;
                margin: 0;
              "
            >
              âˆ’
            </button>
          </h3>

          <div id="playerListContainer" style="display: block">
            <!-- Two column layout for Number of Racers and File Upload -->
            <div
              style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                align-items: start;
              "
            >
              <!-- Left column: Number of Racers -->
              <div class="input-group" style="margin: 0">
                <label
                  for="duckCount"
                  style="font-size: 16px; font-weight: bold"
                  >Number of Racers:</label
                >
                <input
                  type="number"
                  id="duckCount"
                  min="10"
                  max="10000"
                  value="300"
                  style="
                    font-size: 18px;
                    padding: 12px;
                    font-weight: bold;
                    width: 100%;
                  "
                />
              </div>

              <!-- Right column: Racer List File -->
              <div class="input-group" style="margin: 0">
                <label
                  for="duckNamesFile"
                  id="fileLabel"
                  style="font-size: 16px; font-weight: bold; color: #fff"
                >
                  Racer List File (CSV/Excel):
                </label>
                <div style="display: flex; gap: 10px; align-items: center">
                  <input
                    type="file"
                    id="duckNamesFile"
                    accept=".csv,.xlsx,.xls"
                    onchange="game.loadDuckNames(event)"
                    style="
                      flex: 1;
                      font-size: 16px;
                      padding: 12px;
                      cursor: pointer;
                      border: 2px dashed #667eea;
                      border-radius: 8px;
                      background: rgba(0, 0, 0, 0.3);
                    "
                  />
                  <button
                    onclick="game.clearLoadedFile()"
                    id="clearFileBtn"
                    class="btn btn-warning"
                    style="padding: 12px 20px; font-size: 16px"
                  >
                    ğŸ—‘ï¸ Clear
                  </button>
                </div>
                <small
                  style="
                    color: #ccc;
                    display: block;
                    margin-top: 8px;
                    font-size: 14px;
                  "
                >
                </small>
              </div>
            </div>
          </div>
          <!-- end playerListContainer -->
        </div>

        <!-- Audio Settings Section -->
        <div
          style="
            margin: 20px 0;
            padding: 18px;
            background: rgba(46, 213, 115, 0.1);
            border: 1px solid #2ed573;
            border-radius: 10px;
          "
        >
          <h3
            style="
              color: #2ed573;
              margin: 0 0 12px 0;
              font-size: 17px;
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 8px;
            "
          >
            <span>ğŸ”Š Ã‚m thanh</span>
            <button
              class="btn btn-small"
              onclick="game.toggleAudioSection()"
              style="
                background: #2ed573;
                padding: 5px 12px;
                font-size: 14px;
                margin: 0;
              "
            >
              âˆ’
            </button>
          </h3>

          <div id="audioContainer" style="display: block">
            <!-- Two column layout for Enable Sound and Custom Race Sound -->
            <div
              style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                align-items: start;
              "
            >
              <!-- Left column: Enable Sound -->
              <div class="input-group" style="margin: 0">
                <label
                  for="soundToggle"
                  style="
                    font-size: 17px;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    cursor: pointer;
                    padding: 10px;
                    background: rgba(0, 0, 0, 0.2);
                    border-radius: 6px;
                    border: 1px solid #2ed573;
                  "
                >
                  <input
                    type="checkbox"
                    id="soundToggle"
                    checked
                    style="width: 24px; height: 24px; cursor: pointer"
                  />
                  <span style="font-weight: 600">Enable Sound</span>
                </label>
              </div>

              <!-- Right column: Custom Race Sound -->
              <div class="input-group" style="margin: 0">
                <label
                  for="customSoundFile"
                  id="audioFileLabel"
                  style="font-size: 15px; font-weight: 500"
                  >Custom Race Sound (MP3):</label
                >
                <div style="display: flex; gap: 10px; align-items: center">
                  <input
                    type="file"
                    id="customSoundFile"
                    accept=".mp3,.wav,.ogg"
                    style="
                      flex: 1;
                      padding: 10px;
                      font-size: 14px;
                      border: 1px solid #2ed573;
                      border-radius: 6px;
                      background: rgba(0, 0, 0, 0.2);
                    "
                  />
                  <button
                    onclick="game.clearAudioFile()"
                    id="clearAudioBtn"
                    class="btn btn-warning"
                    style="padding: 10px 16px; font-size: 14px"
                  >
                    ğŸ—‘ï¸ Clear
                  </button>
                </div>
                <small
                  style="
                    color: #2ed573;
                    display: block;
                    margin-top: 5px;
                    font-weight: 500;
                  "
                >
                  <br />
                  <strong style="color: #ffd700"></strong>
                </small>
              </div>
            </div>
          </div>
          <!-- end audioContainer -->
        </div>

        <!-- Display Settings Section -->
        <div
          style="
            margin: 20px 0;
            padding: 18px;
            background: rgba(255, 159, 64, 0.1);
            border: 1px solid #ff9f40;
            border-radius: 10px;
          "
        >
          <h3
            style="
              color: #ff9f40;
              margin: 0 0 12px 0;
              font-size: 17px;
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 8px;
            "
          >
            <span>ğŸ–¥ï¸ CÃ i Ä‘áº·t mÃ n hÃ¬nh</span>
            <button
              class="btn btn-small"
              onclick="game.toggleDisplaySection()"
              style="
                background: #ff9f40;
                padding: 5px 12px;
                font-size: 14px;
                margin: 0;
              "
            >
              âˆ’
            </button>
          </h3>
          <div id="displayContainer" style="display: block">
            <div style="display: flex; flex-direction: column; gap: 8px">
              <label style="font-size: 15px; color: #fff; font-weight: 500"
                >Race Track Aspect Ratio:</label
              >
              <input
                type="text"
                id="raceTrackAspectRatio"
                value="20:5"
                placeholder="e.g., 16:9, 30:9, 21:9"
                style="
                  padding: 12px;
                  background: rgba(0, 0, 0, 0.3);
                  border: 1px solid #ff9f40;
                  border-radius: 6px;
                  color: #fff;
                  font-size: 16px;
                "
                oninput="validateAspectRatioInput(this)"
              />
              <small style="color: #888; font-size: 13px">
                Format: width:height (e.g., 16:9, 30:9)
              </small>
            </div>

            <div
              class="input-group"
              style="margin-top: 15px; display: flex; gap: 10px"
            >
              <button
                class="btn btn-small"
                onclick="game.applyResultPanelSettings()"
                style="
                  background: #667eea;
                  flex: 1;
                  padding: 12px;
                  font-size: 15px;
                "
              >
                âœ“ Apply
              </button>
              <button
                class="btn btn-small"
                onclick="game.resetResultPanelSettings()"
                style="
                  background: #888;
                  flex: 1;
                  padding: 12px;
                  font-size: 15px;
                "
              >
                âŸ² Reset
              </button>
            </div>

            <!-- Open Display Button -->
            <div class="input-group" style="margin-top: 20px">
              <a
                href="display.html"
                target="_blank"
                class="btn btn-secondary"
                id="openDisplayBtn"
                style="
                  width: 100%;
                  padding: 18px;
                  font-size: 20px;
                  font-weight: bold;
                  margin-bottom: 10px;
                  text-align: center;
                  text-decoration: none;
                  display: inline-block;
                  pointer-events: none;
                  opacity: 0.5;
                  background: linear-gradient(135deg, #667eea, #764ba2);
                  border: none;
                  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                "
              >
                â³ Loading Icons...
              </a>
              <small
                style="color: #ffd700; font-weight: bold; font-size: 15px"
              ></small
              ><br />
              <small style="color: #888; font-size: 13px"></small>
            </div>
          </div>
          <!-- end displayContainer -->
        </div>
      </div>
      <!-- end game settings -->

      <!-- Race Info (for control window) -->
      <div
        class="race-info"
        id="raceInfo"
        style="margin-top: 20px; position: relative"
      >
        <div class="info-item">
          <span class="label">Race:</span>
          <span id="raceNumber" class="value">#1</span>
        </div>
        <div class="info-item">
          <span class="label">Time Left:</span>
          <span id="timeLeft" class="value">30s</span>
        </div>
        <div class="info-item">
          <span class="label">Status:</span>
          <span id="raceStatus" class="value">Waiting</span>
        </div>
      </div>

      <!-- Result Panel Settings - Collapsible -->
      <div class="result-panel-settings">
        <div>
          <div style="display: flex; justify-content: center">
            <button
              class="btn btn-small"
              onclick="game.toggleResultPanelSettings()"
              style="background: #686964; width: auto"
            >
              âš™ï¸ Result Panel Settings
            </button>
          </div>

          <div
            id="resultPanelSettingsContainer"
            style="
              display: none;
              margin-top: 15px;
              padding: 15px;
              background: rgba(102, 126, 234, 0.1);
              border-radius: 8px;
            "
          >
            <div
              class="main-panel-prize-settings"
              style="font-size: 14px; color: #fff; margin-bottom: 10px"
            >
              <div class="input-group">
                <label for="prizeTitleInput">Prize Title:</label>
                <input
                  type="text"
                  id="prizeTitleInput"
                  placeholder="Prize Results"
                  value="Prize Results"
                  maxlength="50"
                  style="
                    padding: 8px;
                    border-radius: 5px;
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    background: rgba(0, 0, 0, 0.3);
                    color: white;
                    width: 100%;
                  "
                />
                <small style="color: #888"
                  >This will appear on result panel and popup</small
                >
              </div>

              <!-- Result Prize Assignment Settings -->
              <div
                class="main-panel-prize-settings"
                style="
                  margin-top: 15px;
                  padding: 10px;
                  background: rgba(102, 126, 234, 0.1);
                  border: 1px solid #667eea;
                  border-radius: 5px;
                "
              >
                <h4 style="color: #667eea; font-size: 16px; margin: 0 0 10px 0">
                  ğŸ“Š GÃ¡n Giáº£i thÆ°á»Ÿng cho Káº¿t quáº£ (Result)
                </h4>

                <!-- Prize Group Input for Result -->
                <div
                  style="
                    background: rgba(0, 0, 0, 0.3);
                    padding: 12px;
                    border-radius: 5px;
                    margin-bottom: 10px;
                  "
                >
                  <div style="display: flex; gap: 8px; margin-bottom: 8px">
                    <input
                      type="text"
                      id="prizeResultGroupName"
                      placeholder="TÃªn giáº£i (VD: Giáº£i Khuyáº¿n KhÃ­ch)"
                      style="
                        flex: 2;
                        padding: 8px;
                        background: #222;
                        color: white;
                        border: 1px solid #444;
                        border-radius: 3px;
                      "
                    />
                    <input
                      type="number"
                      id="prizeResultGroupCount"
                      placeholder="Sá»‘ ngÆ°á»i"
                      min="1"
                      value="1"
                      style="
                        flex: 1;
                        padding: 8px;
                        background: #222;
                        color: white;
                        border: 1px solid #444;
                        border-radius: 3px;
                        max-width: 100px;
                      "
                    />
                    <button
                      class="btn btn-small"
                      onclick="game.addPrizeResultGroup()"
                      style="
                        background: #8e44ad;
                        padding: 8px 15px;
                        font-size: 13px;
                        white-space: nowrap;
                      "
                    >
                      + ThÃªm nhÃ³m giáº£i
                    </button>
                  </div>
                  <small style="color: #888; display: block">
                    ğŸ’¡ Táº¡o nhiá»u hÃ ng gÃ¡n giáº£i cÃ¹ng tÃªn má»™t lÃºc
                  </small>
                </div>

                <div
                  id="prizeAssignmentResultContainer"
                  style="
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                    max-height: 250px;
                    overflow-y: auto;
                  "
                >
                  <!-- Prize assignment fields will be dynamically added here -->
                </div>
                <div
                  style="
                    margin-top: 10px;
                    display: flex;
                    gap: 5px;
                    flex-wrap: wrap;
                  "
                >
                  <button
                    class="btn btn-small"
                    onclick="game.loadVictoryHistoryToAssignments()"
                    style="
                      background: #f39c12;
                      padding: 5px 10px;
                      font-size: 12px;
                    "
                  >
                    ğŸ“œ Load Victory History
                  </button>
                  <button
                    class="btn btn-small"
                    onclick="game.clearAllResultAssignments()"
                    style="
                      background: #c0392b;
                      padding: 5px 10px;
                      font-size: 12px;
                    "
                  >
                    ğŸ—‘ï¸ XÃ³a táº¥t cáº£
                  </button>
                  <button
                    class="btn btn-small"
                    onclick="game.reverseAssignments()"
                    style="
                      background: #9b59b6;
                      padding: 5px 10px;
                      font-size: 12px;
                    "
                    title="Äáº£o ngÆ°á»£c thá»© tá»± danh sÃ¡ch"
                  >
                    ğŸ”„ Äáº£o thá»© tá»±
                  </button>
                  <button
                    class="btn btn-small"
                    onclick="game.showPrizeAssignments()"
                    style="
                      background: #27ae60;
                      padding: 5px 10px;
                      font-size: 12px;
                    "
                  >
                    ğŸ“‹ Show Assignments
                  </button>
                  <button
                    class="btn btn-small"
                    onclick="game.applyPrizeResultAssignment()"
                    style="
                      background: #667eea;
                      padding: 5px 10px;
                      font-size: 12px;
                    "
                  >
                    âœ“ Apply & Show Results
                  </button>
                </div>

                <!-- Result Assignments Display (Toggle) -->
                <div
                  id="resultAssignmentsDisplay"
                  style="
                    display: none;
                    margin-top: 10px;
                    padding: 10px;
                    background: rgba(0, 0, 0, 0.4);
                    border-radius: 5px;
                    border: 1px solid #667eea;
                    max-height: 200px;
                    overflow-y: auto;
                  "
                >
                  <div
                    style="
                      color: #667eea;
                      font-weight: bold;
                      margin-bottom: 5px;
                    "
                  >
                    ğŸ Result Assignments:
                  </div>
                  <div
                    id="resultAssignmentsContent"
                    style="color: #fff; font-size: 13px; line-height: 1.6"
                  ></div>
                </div>

                <small style="color: #888; margin-top: 8px; display: block"
                  >* Chá»n ngÆ°á»i nháº­n giáº£i tá»« danh sÃ¡ch "Victory History" Ä‘Ã£
                  lÆ°u.</small
                >
              </div>
            </div>
            <!-- Result Panel Background Settings -->
            <div
              class="main-panel-background-settings"
              style="font-size: 14px; color: #fff; margin: 20px 0 10px 0"
            >
              <div
                style="
                  display: flex;
                  justify-content: center;
                  margin-bottom: 10px;
                "
              >
                <button
                  class="btn btn-small"
                  onclick="game.toggleBackgroundSettings()"
                  style="background: #ff9f40; width: auto"
                >
                  ğŸ¨ Background Settings
                </button>
              </div>

              <div id="backgroundSettingsContainer" style="display: none">
                <div class="input-group">
                  <label for="resultBgType">Background Type:</label>
                  <select
                    id="resultBgType"
                    onchange="game.toggleResultBackground()"
                  >
                    <option value="default">Default</option>
                    <option value="color">Solid Color</option>
                    <option value="image">Custom Image</option>
                  </select>
                </div>

                <div
                  class="input-group"
                  id="resultBgColorGroup"
                  style="display: none"
                >
                  <label for="resultBgColor">Background Color:</label>
                  <input type="color" id="resultBgColor" value="#1a1a2e" />
                </div>

                <div
                  class="input-group"
                  id="resultBgImageGroup"
                  style="display: none"
                >
                  <label for="resultBgImage">Background Image:</label>
                  <input
                    type="file"
                    id="resultBgImage"
                    accept="image/*"
                    onchange="game.loadResultBackgroundImage(event)"
                  />
                  <small style="color: #888">Upload JPG, PNG, or GIF</small>
                </div>

                <div
                  style="
                    margin-top: 15px;
                    padding: 10px;
                    background: rgba(102, 126, 234, 0.1);
                    border-radius: 5px;
                  "
                >
                  <h4
                    style="color: #667eea; font-size: 16px; margin: 0 0 10px 0"
                  >
                    ğŸ“ Layout Settings
                  </h4>
                  <div
                    style="
                      display: grid;
                      grid-template-columns: 1fr 1fr;
                      gap: 10px;
                    "
                  >
                    <div
                      style="display: flex; flex-direction: column; gap: 5px"
                    >
                      <label style="font-size: 14px; color: #fff"
                        >Winners Grid Width:</label
                      >
                      <div style="display: flex; align-items: center; gap: 8px">
                        <input
                          type="range"
                          id="winnersGridWidth"
                          min="70"
                          max="100"
                          value="95"
                          style="flex: 1"
                        />
                        <span
                          id="winnersGridWidthValue"
                          style="
                            min-width: 40px;
                            font-size: 14px;
                            color: #667eea;
                          "
                          >95%</span
                        >
                      </div>
                    </div>
                    <div
                      style="display: flex; flex-direction: column; gap: 5px"
                    >
                      <label style="font-size: 14px; color: #fff"
                        >Card Gap:</label
                      >
                      <div style="display: flex; align-items: center; gap: 8px">
                        <input
                          type="range"
                          id="cardGap"
                          min="0.5"
                          max="3"
                          step="0.5"
                          value="1.5"
                          style="flex: 1"
                        />
                        <span
                          id="cardGapValue"
                          style="
                            min-width: 40px;
                            font-size: 14px;
                            color: #667eea;
                          "
                          >1.5%</span
                        >
                      </div>
                    </div>
                  </div>
                  <small style="color: #888; margin-top: 8px; display: block"
                    >Adjust race track dimensions and winner card layout</small
                  >
                </div>

                <div class="input-group">
                  <button
                    class="btn btn-small"
                    onclick="game.applyResultPanelSettings()"
                    style="background: #667eea; margin-right: 10px"
                  >
                    âœ“ Apply
                  </button>
                  <button
                    class="btn btn-small"
                    onclick="game.resetResultPanelSettings()"
                    style="background: #888"
                  >
                    âŸ² Reset
                  </button>
                </div>
              </div>
              <!-- end backgroundSettingsContainer -->
            </div>
            <!-- end layout settings -->
          </div>
          <!-- end main panel settings container -->
        </div>
        <!-- end collapsible -->
      </div>
      <!-- end main panel settings -->

      <!-- Result Panel Preview - Independent -->
      <div class="result-panel" id="resultPanel" style="margin-top: 30px">
        <h2 id="resultTitle">Results</h2>
        <div id="resultMessage"></div>
      </div>

      <script>
        // Update slider values display
        document
          .getElementById("winnersGridWidth")
          .addEventListener("input", (e) => {
            document.getElementById("winnersGridWidthValue").textContent =
              e.target.value + "%";
          });
        document.getElementById("cardGap").addEventListener("input", (e) => {
          document.getElementById("cardGapValue").textContent =
            e.target.value + "%";
        });

        // Validate aspect ratio input format
        function validateAspectRatioInput(input) {
          const value = input.value.trim();
          // Allow digits, colon, and spaces
          const cleaned = value.replace(/[^0-9:]/g, "");
          if (cleaned !== value) {
            input.value = cleaned;
          }

          // Check if format is valid (e.g., "16:9", "30:9")
          const match = cleaned.match(/^(\d+):(\d+)$/);
          if (match) {
            input.style.borderColor = "#667eea";
            input.style.background = "rgba(0,0,0,0.3)";
          } else if (cleaned.length > 0) {
            input.style.borderColor = "#ff6b6b";
            input.style.background = "rgba(255,107,107,0.1)";
          } else {
            input.style.borderColor = "#667eea";
            input.style.background = "rgba(0,0,0,0.3)";
          }
        }
      </script>
    </div>
    <!-- end main container -->

    <!-- Toast Notification Container -->
    <div
      id="toastContainer"
      style="
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 10px;
        pointer-events: none;
      "
    ></div>
    <!-- end toast notification container -->

    <!-- Victory Popup (outside container for max z-index) -->
    <!-- <div class="victory-popup" id="victoryPopup">
      <div class="victory-overlay" onclick="game.closeVictoryPopup()"></div>
      <div class="victory-content">
        <div class="victory-header">
          <h1>ğŸ‰ VICTORY! ğŸ‰</h1>
        </div>
        <div class="victory-body">
          <div class="winner-icon" id="winnerIcon"></div>
          <h2 class="winner-name" id="winnerName">Winner Name</h2>
          <div class="winner-stats" id="winnerStats"></div>
        </div>
        <div class="victory-footer" style="display: none">
          <button class="btn btn-primary" onclick="game.continueRace()">
            ğŸ¯ Continue (Next Race)
          </button>
          <button
            class="btn btn-secondary"
            onclick="
              game.closeVictoryPopup();
              game.showWinnersPanel();
            "
          >
            ğŸ“‹ View Results
          </button>
        </div>
      </div>
    </div> -->
    <!-- end victory popup -->

    <!-- Top N Victory Popup -->
    <div class="victory-popup" id="topNVictoryPopup">
      <div class="victory-overlay" onclick="game.closeTopNVictoryPopup()"></div>
      <div class="victory-content victory-content-topn">
        <div class="victory-header">
          <h1>ğŸ† TOP <span id="topNCount">N</span> WINNERS! ğŸ†</h1>
        </div>
        <div class="victory-body victory-body-topn" id="topNWinnersGrid">
          <!-- Winners will be populated here -->
        </div>
        <div class="victory-footer">
          <button
            class="btn btn-primary"
            onclick="
              game.closeTopNVictoryPopup();
              game.resetRace();
            "
          >
            â–¶ï¸ Next Race
          </button>
          <button
            class="btn btn-secondary"
            onclick="
              game.closeTopNVictoryPopup();
              game.fullReset();
            "
          >
            ğŸ”„ Play Again
          </button>
          <button
            class="btn btn-secondary"
            onclick="
              game.closeTopNVictoryPopup();
              game.showTopNResultPanel();
            "
          >
            ğŸ“‹ View Full Results
          </button>
        </div>
        <!-- end victory footer -->
      </div>
      <!-- end victory content -->
    </div>
    <!-- end top N victory popup -->

    <!-- Leaderboard - Hidden -->
    <div class="history-win" id="historyWin">
      <h3>ğŸ† Victory History</h3>
      <div id="historyWinList"></div>
      <button
        class="btn btn-small"
        onclick="
          game.resetHistory();
          location.reload();
        "
        style="margin-top: 10px; width: 100%"
      >
        ğŸ”„ Restart (Clear History)
      </button>
    </div>

    <!-- SheetJS library for Excel file support -->
    <script src="lib/xlsx.full.min.js"></script>

    <script type="module" src="game.js?v=66"></script>
    <script type="module">
      // Initialize simplified prize UI after game loads
      setTimeout(() => {
        if (window.game && game.renderSimplePrizeUI) {
          game.renderSimplePrizeUI();
        }
        // Render race scripts to show existing scripts
        if (window.game && game.renderRaceScripts) {
          game.renderRaceScripts();
        }
      }, 500);
    </script>
  </body>
</html>
